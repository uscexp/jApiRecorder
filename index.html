<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>jApiRecorder by uscexp</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>jApiRecorder</h1>
        <p>Dynamic proxy to record and replay API method calls.</p>

        <p class="view"><a href="https://github.com/uscexp/jApiRecorder">View the Project on GitHub <small>uscexp/jApiRecorder</small></a></p>


        <ul>
          <li><a href="https://github.com/uscexp/jApiRecorder/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/uscexp/jApiRecorder/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/uscexp/jApiRecorder">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a name="japirecorder" class="anchor" href="#japirecorder"><span class="octicon octicon-link"></span></a>jApiRecorder</h1>

<p>A dynamic proxy to record and replay API method calls e.g. for testing porposes.</p>

<h2>
<a name="features" class="anchor" href="#features"><span class="octicon octicon-link"></span></a>Features</h2>

<ul>
<li>record and/or replay an API method call return value.</li>
<li>replace attibute values of return values via dot notation attribute path on replay.</li>
<li>manipulate replacement values before setting them to the attribute values on the recorded value.</li>
</ul><h2>
<a name="description" class="anchor" href="#description"><span class="octicon octicon-link"></span></a>Description</h2>

<p>The jApiRecorder one can creat a dynamic proxy of a class to record/replay API method calls.</p>

<h3>
<a name="modes" class="anchor" href="#modes"><span class="octicon octicon-link"></span></a>Modes</h3>

<p>There are four modes to go:</p>

<ul>
<li>FOREWARD - calls the original method directly and returns the value.</li>
<li>RECORD - calls the original method and records the returned value.</li>
<li>RP_ONLINE - tries first to get a return value from the recorded data. if there is one it will be returned,
else it calls the original method, records the return value and returns it.</li>
<li>RP_OFFLINE - tries to get a return value from the recorded data. if there is none it will return null.</li>
</ul><h3>
<a name="readwritestrategy-and-contenttypestrategy" class="anchor" href="#readwritestrategy-and-contenttypestrategy"><span class="octicon octicon-link"></span></a>ReadWriteStrategy and ContentTypeStrategy</h3>

<p>It is possible to implement your own <code>ReadWriteStrategy</code> and/or <code>ContentTypeStrategy</code>.
You only have to implement the given interfaces.</p>

<p>Already implemented <code>ContentTypeStrategy</code> is:
<code>XStreamContentTypeStrategy</code> which serialize/deserialize the objects to be recorded/replayed with XStream (XML).</p>

<p>Already implemented <code>ReadWriteStrategy</code> is:
<code>H2ReadWriteStrategy</code> which reads/writes the serialized objects to be recorded/replayed within a H2 database (memory or file database).</p>

<h3>
<a name="attribute-replacement" class="anchor" href="#attribute-replacement"><span class="octicon octicon-link"></span></a>Attribute Replacement</h3>

<p>One can replace attribute values in the recorded values.
Specify an attribute path from the recorded  result object in dot notation form (see <a href="http://uscexp.github.io/jDotNotation/">jDotNotation</a>) to the attribute one want to change. Set a fix value or use an argument passed to the method call.
The value one want to set to an attribute in the result can be manipulated before setting it to the attribute.
E.g. one want to change a <code>Date</code> attribute of the result and change it to the current date. One can add serveral replacement value treatments to change the value, in this example to change it to the current date.</p>

<h2>
<a name="example" class="anchor" href="#example"><span class="octicon octicon-link"></span></a>Example</h2>

<p>An example from a junit test (see more junit tests form more code examples):</p>

<div class="highlight highlight-java"><pre><span class="n">ContentTypeStrategy</span> <span class="n">contentTypeStrategy</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">XStreamContentTypeStrategy</span><span class="o">();</span>
<span class="n">ReadWriteStrategy</span> <span class="n">readWriteStrategy</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">H2ReadWriteStrategy</span><span class="o">();</span>
<span class="n">RecordReplayConfiguration</span> <span class="n">recordReplayConfiguration</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">RecordReplayConfiguration</span><span class="o">();</span>
<span class="n">recordReplayConfiguration</span><span class="o">.</span><span class="na">addArgumentIndices4PrimaryKey</span><span class="o">(</span><span class="s">"simpleLevel2Method"</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
<span class="n">TestClass</span> <span class="n">testClass</span> <span class="o">=</span> <span class="o">(</span><span class="n">TestClass</span><span class="o">)</span> <span class="n">RecordReplayManager</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">TestClass</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">RecordReplayMode</span><span class="o">.</span><span class="na">RECORD</span><span class="o">,</span> <span class="n">contentTypeStrategy</span><span class="o">,</span> <span class="n">readWriteStrategy</span><span class="o">,</span> <span class="n">recordReplayConfiguration</span><span class="o">);</span>

<span class="n">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Date</span><span class="o">();</span>
<span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="s">"extern"</span><span class="o">;</span>
<span class="n">TestClass</span> <span class="n">result</span> <span class="o">=</span> <span class="n">testClass</span><span class="o">.</span><span class="na">simpleLevel2Method</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">text</span><span class="o">,</span> <span class="n">date</span><span class="o">);</span>

<span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="n">text</span><span class="o">,</span> <span class="n">result</span><span class="o">.</span><span class="na">getText</span><span class="o">());</span>

<span class="n">String</span> <span class="n">value</span> <span class="o">=</span> <span class="s">"post_extern"</span><span class="o">;</span>
<span class="n">ReplacementValue</span> <span class="n">replacementValue</span> <span class="o">=</span> <span class="n">ReplacementValueFactory</span><span class="o">.</span><span class="na">createReplacementGivenValue</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
<span class="n">ReplacementConfiguration</span> <span class="n">replacementConfiguration</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">ReplacementConfiguration</span><span class="o">(</span><span class="s">"text"</span><span class="o">,</span> <span class="n">replacementValue</span><span class="o">);</span>
<span class="n">recordReplayConfiguration</span><span class="o">.</span><span class="na">addReplacementConfiguration</span><span class="o">(</span><span class="s">"simpleLevel2Method"</span><span class="o">,</span> <span class="n">replacementConfiguration</span> <span class="o">);</span>
<span class="n">testClass</span> <span class="o">=</span> <span class="o">(</span><span class="n">TestClass</span><span class="o">)</span> <span class="n">RecordReplayManager</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">TestClass</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">RecordReplayMode</span><span class="o">.</span><span class="na">RP_OFFLINE</span><span class="o">,</span> <span class="n">contentTypeStrategy</span><span class="o">,</span> <span class="n">readWriteStrategy</span><span class="o">,</span> <span class="n">recordReplayConfiguration</span><span class="o">);</span>

<span class="n">Date</span> <span class="n">date2</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Date</span><span class="o">();</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">testClass</span><span class="o">.</span><span class="na">simpleLevel2Method</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">text</span><span class="o">,</span> <span class="n">date2</span><span class="o">);</span>

<span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">result</span><span class="o">.</span><span class="na">getText</span><span class="o">());</span>
</pre></div>

<p>I want to record/replay the method call <code>simpleLevel2Method</code> in <code>TestClass</code>.
First I create a <code>ContentTypeStrategy</code> and a <code>ReadWriteStrategy</code> instance. Then I need a <code>RecordReplayConfiguration</code> where I define which method arguments indices (here 0 and 1) are used to create a primary key for the recorded value for later retrieval. I create a dynamic proxy instance of my <code>TestClass</code> in RECORD Mode. Then I call the method to record the result value.
Afterwards I create a <code>ReplacementValue</code>, because I want to change the <code>text</code> attribute in my <code>TestClass</code> on replay. Then I create a <code>ReplacementConfiguration</code> with an attribute path to the <code>text</code> attribute and the replacement value and add it to the <code>RecordReplayConfiguration</code> for <code>simpleLevel2Method</code>. I create a dynamic proxy instance of my <code>TestClass</code> in PB_OFFLINE Mode. After calling the <code>simpleLevel2Method</code> I get the previous recorded value of the <code>TestClass</code> except the <code>text</code> attribute which returns the value I set with the <code>ReplacementConfiguration</code>.</p>

<h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>To use the library in your java project just put the binary jar file to your classpath. The maven dependency can be found here: <a href="http://mvnrepository.com/artifact/com.github.uscexp/jApiRecorder">mvnrepository</a></p>

<p>(C) 2014 by haui</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/uscexp">uscexp</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>